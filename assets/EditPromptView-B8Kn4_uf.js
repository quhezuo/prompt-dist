import{_ as E,u as D,a as F,m as R,r as h,c as _,b as j,o as q,k as K,d as n,e as t,p as g,t as v,w as C,q as c,v as f,s as N,F as y,j as x,x as L,f as $,l,y as A}from"./index-BJiyRC3O.js";const H={class:"edit-prompt-view"},z={class:"container"},G={class:"page-header"},J={class:"page-title"},O={class:"form-group"},Q={class:"form-group"},W={class:"form-group"},X=["value"],Y={class:"form-group"},Z={class:"tags-input"},tt={class:"tags-container"},et=["onClick"],ot={class:"tag-input-container"},st=["onKeydown"],at={class:"form-group"},nt={class:"examples-container"},lt=["src"],rt=["onClick"],it={key:0,class:"upload-container"},pt={__name:"EditPromptView",setup(dt){const i=j(),p=K(),u=D(),I=F(),e=R({title:"",content:"",categoryId:1,tags:[],examples:[]}),d=h(""),b=h(null),m=_(()=>!!i.params.id),T=_(()=>I.categories);q(()=>{if(m.value){const s=u.getPromptById(parseInt(i.params.id));s?(e.title=s.title,e.content=s.content,e.categoryId=s.categoryId,e.tags=[...s.tags],e.examples=[...s.examples]):p.push({name:"not-found"})}});const k=()=>{const s=d.value.trim();s&&!e.tags.includes(s)&&(e.tags.push(s),d.value="")},V=s=>{e.tags.splice(s,1)},B=()=>{b.value.click()},P=s=>{const o=s.target.files[0];if(o&&e.examples.length<5){const a=new FileReader;a.onload=r=>{e.examples.push(r.target.result)},a.readAsDataURL(o),s.target.value=""}},S=s=>{e.examples.splice(s,1)},M=async()=>{try{m.value?u.updatePrompt({id:parseInt(i.params.id),title:e.title,content:e.content,categoryId:e.categoryId,tags:e.tags,examples:e.examples}):u.addPrompt({title:e.title,content:e.content,categoryId:e.categoryId,tags:e.tags,examples:e.examples}),await A(),p.push({name:"home",replace:!0}),setTimeout(()=>{(i.name==="create-prompt"||i.name==="edit-prompt")&&(window.location.href="/")},100)}catch(s){console.error("保存提示词时出错:",s),p.push({name:"home"})}},w=()=>{p.go(-1)};return(s,o)=>(l(),n("div",H,[t("div",z,[t("div",G,[t("button",{class:"back-button",onClick:w},o[4]||(o[4]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[t("line",{x1:"19",y1:"12",x2:"5",y2:"12"}),t("polyline",{points:"12 19 5 12 12 5"})],-1),g(" 返回 ")])),t("h1",J,v(m.value?"编辑提示词":"创建提示词"),1)]),t("form",{onSubmit:C(M,["prevent"]),class:"prompt-form"},[t("div",O,[o[5]||(o[5]=t("label",{for:"promptTitle",class:"form-label"},"标题",-1)),c(t("input",{type:"text",id:"promptTitle","onUpdate:modelValue":o[0]||(o[0]=a=>e.title=a),class:"form-control",placeholder:"输入提示词标题",required:""},null,512),[[f,e.title]])]),t("div",Q,[o[6]||(o[6]=t("label",{for:"promptContent",class:"form-label"},"内容",-1)),c(t("textarea",{id:"promptContent","onUpdate:modelValue":o[1]||(o[1]=a=>e.content=a),class:"form-control",placeholder:"输入提示词内容",rows:"8",required:""},null,512),[[f,e.content]])]),t("div",W,[o[7]||(o[7]=t("label",{for:"promptCategory",class:"form-label"},"分类",-1)),c(t("select",{id:"promptCategory","onUpdate:modelValue":o[2]||(o[2]=a=>e.categoryId=a),class:"form-control"},[(l(!0),n(y,null,x(T.value,a=>(l(),n("option",{key:a.id,value:a.id},v(a.name),9,X))),128))],512),[[N,e.categoryId]])]),t("div",Y,[o[8]||(o[8]=t("label",{class:"form-label"},"标签",-1)),t("div",Z,[t("div",tt,[(l(!0),n(y,null,x(e.tags,(a,r)=>(l(),n("span",{key:r,class:"tag"},[g(v(a)+" ",1),t("button",{type:"button",class:"remove-tag",onClick:U=>V(r)},"×",8,et)]))),128))]),t("div",ot,[c(t("input",{type:"text","onUpdate:modelValue":o[3]||(o[3]=a=>d.value=a),onKeydown:L(C(k,["prevent"]),["enter"]),placeholder:"添加标签...",class:"tag-input"},null,40,st),[[f,d.value]]),t("button",{type:"button",class:"add-tag-button",onClick:k},"添加")])])]),t("div",at,[o[10]||(o[10]=t("label",{class:"form-label"},"示例图片",-1)),t("div",nt,[(l(!0),n(y,null,x(e.examples,(a,r)=>(l(),n("div",{key:r,class:"example-item"},[t("img",{src:a,alt:"示例图片",class:"example-image"},null,8,lt),t("button",{type:"button",class:"remove-example",onClick:U=>S(r)},"×",8,rt)]))),128)),e.examples.length<5?(l(),n("div",it,[t("input",{type:"file",ref_key:"fileInput",ref:b,accept:"image/*",onChange:P,class:"file-input"},null,544),t("button",{type:"button",class:"upload-button",onClick:B},o[9]||(o[9]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[t("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),t("polyline",{points:"17 8 12 3 7 8"}),t("line",{x1:"12",y1:"3",x2:"12",y2:"15"})],-1),g(" 上传图片 ")]))])):$("",!0)]),o[11]||(o[11]=t("p",{class:"form-note"},"最多添加5张示例图片",-1))]),t("div",{class:"form-actions"},[t("button",{type:"button",class:"btn-cancel",onClick:w},"取消"),o[12]||(o[12]=t("button",{type:"submit",class:"btn-save"},"保存",-1))])],32)])]))}},ut=E(pt,[["__scopeId","data-v-682290cd"]]);export{ut as default};
